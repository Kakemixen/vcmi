cd $APPVEYOR_BUILD_FOLDER
git submodule update --init --recursive

cd ..

curl -LfsS -o "vcpkg-export-${VCMI_BUILD_PLATFORM}-windows-v140.7z" \
	"https://public.by.files.1drv.com/y4moDp6o0dUunA-TL0bJVxKdolGEis8FsvzBI2-lHj-9BsIrL14wrJWPpzCrN-gLDFqWns3v2lqyVfsUJc2wRH-7qN4YcoXpoKaMqBavHUIooSVhrDclx7hjVLl9ZHJz7APo-WmDnr1alp3pHYcw8UglLenVaQjaz2jqw5svonf9NrZLuHoEeQ9sKzeRFJB6sbQlki3K-iS-e1TkT17R7jxWNTJyGM3kRWKnm6G95tRmqs?access_token=EwAYA61DBAAUmcDj0azQ5tf1lkBfAvHLBzXl5ugAAe1j69HvDXiUeVRmNYJWYdChnQl58C6aZ40HLSz/5d7SpdCeam8Lfkaz%2b5Uk%2bcDMB0R3Kam/fvnR3GpW6gOgCekVTE0Br/sBkue%2bP6R3/3oPSGzSbppd8Opd5KokV4aWFuUIkgzv4LyxulM3r0vAKUgcT6hdN7C6tZqBfNZMPBxx848MyeZIXyyOe14g/AByHNRq9Y3iznovhwFitb2UMb1JtopyAjXDc6bv1KjEWxcVM5GSXtaHohQXy1jZMsq6D1E7HwSy5ixHyIRMAVbxpi8RhKA6YLJOHumiyUaRga1kd0br1PHYFLv6M9FcHaY7RVIUdoegLNk6hzAXLInOjqgDZgAACC8qSu4VjmxK6AEZ7Aw1253t52ObvIIGaoUnDQxVQqfBVexNk0xIoXcHfI%2bfpHr1k8%2bAndtKrnd6dt10Rnlc5LW/YlG4JlH/QmlKpcNWDpC8osYfRtPSusV5tkvyCcwCQMRylpepCh9U4cCqdtHmn45oSe3eGJN9ZqtGuewEowjS1zG1QVOFvVpFVmXEdB76WRSND%2b7wl3cdA8%2bEMRakp%2bY/zDhgT3wEjfcTPZyZgp3wtT2No50yZaMSjbz2evWO8HmUA46qPQLdNV1ih5qrS9CxR4RPwIojH9XOU%2bFYtCX4kD64v5ZeCstW9ZGiJNS1shy83/KNsLqie77U1xgW2wYr6qRDl5k2RTA5c0IvDan5apERJkRkvYtSIQGk6d%2bVTbwpkmFBxtMls9Nm%2btv0%2bVFFH5OB4gGiEHaev3BLMgIuvDnAEM%2b6sH9iCmmiAPlV4rh2FTMpd7ZYxj7HIDGxRqAQC45IoD0iHfquvLjN2A0ss1kMmn5G%2bliWkluB4rO%2b9e8Xn2nxBR5Lj6f06Zi8LtRoQa1XysVp6WMEDi8/NcWj2yscJhECzHDFlf82osMz5SJyyQuzZlVrhLGBwkDZZyTXxAiNut0JYwG7LRE8509cFBesQ3G5Ec0eELN%2bSfyoDYFhg%2brjJK9UMbnF7d3rwAVULxwC"
7z x "vcpkg-export-${VCMI_BUILD_PLATFORM}-windows-v140.7z"

cd $APPVEYOR_BUILD_FOLDER
mkdir build_$VCMI_BUILD_PLATFORM
cd build_$VCMI_BUILD_PLATFORM

source $APPVEYOR_BUILD_FOLDER/CI/get_package_name.sh
cmake -G "$VCMI_GENERATOR" .. -DCMAKE_TOOLCHAIN_FILE=$APPVEYOR_BUILD_FOLDER/../vcpkg/scripts/buildsystems/vcpkg.cmake \
	-DPACKAGE_NAME_SUFFIX:STRING="$VCMI_PACKAGE_NAME_SUFFIX" \
	-DPACKAGE_FILE_NAME:STRING="$VCMI_PACKAGE_FILE_NAME"
